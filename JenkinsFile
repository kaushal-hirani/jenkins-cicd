pipeline {  
    agent any  
    
    tools {  
        jdk 'JDK17'  
        maven 'Maven3'  
    }  
    
    stages {  
        stage('Git Checkout') {  
            steps {  
                git branch: 'main',   
                    credentialsId: 'github-credentials',   
                    url: 'https://github.com/your-username/cicd-demo-project.git'  
            }  
        }  
        
        stage('Build') {  
            steps {  
                sh 'mvn clean compile'  
            }  
        }  
        
        stage('Test') {  
            steps {  
                sh 'mvn test'  
            }  
            post {  
                always {  
                    junit 'target/surefire-reports/*.xml'  
                }  
            }  
        }  
        
        stage('SonarQube Analysis') {  
            steps {  
                withSonarQubeEnv('SonarServer') {  
                    sh 'mvn sonar:sonar'  
                }  
            }  
        }  
        
        stage('JaCoCo Coverage') {  
            steps {  
                jacoco execPattern: 'target/jacoco.exec'  
            }  
        }  
        
        stage('Package') {  
            steps {  
                sh 'mvn package'  
            }  
        }  
    }  
    
    post {  
        success {  
            emailext (  
                subject: "Build Successful: ${currentBuild.fullDisplayName}",  
                body: "Great job! Build completed successfully.",  
                to: "your-email@example.com"  
            )  
        }  
        failure {  
            emailext (  
                subject: "Build Failed: ${currentBuild.fullDisplayName}",  
                body: "Build failed. Please check the Jenkins console for details.",  
                to: "your-email@example.com"  
            )  
        }  
    }  
}
